"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getEnumSelectedItemsValue=getEnumSelectedItemsValue;exports.getEnumSelectedItemValue=getEnumSelectedItemValue;exports.getAnyOfSelectedItemsValue=getAnyOfSelectedItemsValue;exports.getAnyOfSelectedItemValue=getAnyOfSelectedItemValue;exports.getOneOfSelectedItemsValue=getOneOfSelectedItemsValue;exports.getOneOfSelectedItemValue=getOneOfSelectedItemValue;exports.getGroup=getGroup;exports.transformEnumValue=transformEnumValue;exports.transformAnyOfValue=transformAnyOfValue;exports.transformOneOfValue=transformOneOfValue;exports.transformSummaryValue=transformSummaryValue;exports.transformString=transformString;exports.transformNumber=transformNumber;exports.transformObject=transformObject;exports.transformArray=transformArray;exports.transformBoolean=transformBoolean;exports.transformNull=transformNull;exports.transformObjectGroupSummaryValue=transformObjectGroupSummaryValue;exports.transformArrayGroupSummaryValue=transformArrayGroupSummaryValue;exports.transformObjectGroup=transformObjectGroup;exports.transformArrayGroup=transformArrayGroup;exports.transform=transform;exports.default=exports.getVisuallyHiddenText=exports.transformSummaryKey=exports.transformFieldValue=exports.toSummaryValue=void 0;var _debug=_interopRequireDefault(require("debug"));var _toZashiki=_interopRequireDefault(require("shinkansen-transmission/lib/transmission/to-zashiki"));var _fromDocumentToHash=_interopRequireDefault(require("shinkansen-transmission/lib/transmission/from-document-to-hash"));var _getResourceUrl=_interopRequireDefault(require("./common/get-resource-url"));var _common=require("./common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}const log=(0,_debug.default)('zashiki:transformer:to-check-answers');const toSummaryValue=({elements}={})=>{const{title:value=(0,_common.getValue)(elements)}=elements;return value;};exports.toSummaryValue=toSummaryValue;const transformFieldValue=(field={})=>(0,_common.hasValue)(field)?{text:(0,_common.getValue)(field)}:{};exports.transformFieldValue=transformFieldValue;const transformSummaryKey=({elements}={})=>(0,_common.hasTitle)(elements)?{text:(0,_common.getTitle)(elements)}:{};exports.transformSummaryKey=transformSummaryKey;const getVisuallyHiddenText=({elements:{title:visuallyHiddenText=''}={}}={})=>visuallyHiddenText.toLowerCase();exports.getVisuallyHiddenText=getVisuallyHiddenText;function getEnumSelectedItemsValue(items=[],selectedItems=[]){log('getEnumSelectedItemsValue');return selectedItems.reduce((accumulator,selectedItem)=>Reflect.has(items,selectedItem)?accumulator.concat(`<p class="govuk-body">${Reflect.get(items,selectedItem)}</p>`):accumulator,'');}function getEnumSelectedItemValue(items=[],[selectedItem]=[]){log('getEnumSelectedItemValue');return Reflect.has(items,selectedItem)?String(Reflect.get(items,selectedItem)):'';}function getAnyOfSelectedItemsValue(items=[],selectedItems=[]){log('getAnyOfSelectedItemsValue');return selectedItems.reduce((accumulator,selectedItem)=>Reflect.has(items,selectedItem)?accumulator.concat(`<p class="govuk-body">${toSummaryValue(Reflect.get(items,selectedItem))}</p>`):accumulator,'');}function getAnyOfSelectedItemValue(items=[],[selectedItem]=[]){log('getAnyOfSelectedItemValue');return Reflect.has(items,selectedItem)?toSummaryValue(Reflect.get(items,selectedItem)):'';}function getOneOfSelectedItemsValue(items=[],selectedItems=[]){log('getOneOfSelectedItemsValue');return selectedItems.reduce((accumulator,selectedItem)=>Reflect.has(items,selectedItem)?accumulator.concat(`<p class="govuk-body">${toSummaryValue(Reflect.get(items,selectedItem))}</p>`):accumulator,'');}function getOneOfSelectedItemValue(items=[],[selectedItem]=[]){log('getOneOfSelectedItemValue');return Reflect.has(items,selectedItem)?toSummaryValue(Reflect.get(items,selectedItem)):'';}function getGroup(index,array){const group=[];let n=index+1;let sibling=array[n];if(sibling){while(!(0,_common.hasElementsTitle)(sibling)){group.push(sibling);n=n+1;sibling=array[n];if(!sibling)break;}}return group;}function transformEnumValue({items,selectedItems}={}){log('transformEnumValue');if(selectedItems.length<1){return{};}else{if(selectedItems.length>1){return{html:getEnumSelectedItemsValue(items,selectedItems)};}}return{text:getEnumSelectedItemValue(items,selectedItems)};}function transformAnyOfValue({items,selectedItems}={}){log('transformAnyOfValue');if(selectedItems.length<1){return{};}else{if(selectedItems.length>1){return{html:getAnyOfSelectedItemsValue(items,selectedItems)};}}return{text:getAnyOfSelectedItemValue(items,selectedItems)};}function transformOneOfValue({items,selectedItems}={}){log('transformOneOfValue');if(selectedItems.length<1){return{};}else{if(selectedItems.length>1){return{html:getOneOfSelectedItemsValue(items,selectedItems)};}}return{text:getOneOfSelectedItemValue(items,selectedItems)};}function transformSummaryValue({elements}){log('transformSummaryValue');if((0,_common.hasEnum)(elements)){const field=(0,_common.getEnum)(elements);return transformEnumValue(field);}else{if((0,_common.hasAnyOf)(elements)){const field=(0,_common.getAnyOf)(elements);return transformAnyOfValue(field);}else{if((0,_common.hasOneOf)(elements)){const field=(0,_common.getOneOf)(elements);return transformOneOfValue(field);}else{if((0,_common.hasField)(elements)){const field=(0,_common.getField)(elements);return transformFieldValue(field);}}}}return{};}function transformString(zashiki,resource){log('transformString');return{key:transformSummaryKey(zashiki),value:transformSummaryValue(zashiki),actions:{items:[{href:(0,_getResourceUrl.default)(resource),text:'Change',visuallyHiddenText:getVisuallyHiddenText(zashiki)}]}};}function transformNumber(zashiki,resource){log('transformNumber');return{key:transformSummaryKey(zashiki),value:transformSummaryValue(zashiki),actions:{items:[{href:(0,_getResourceUrl.default)(resource),text:'Change',visuallyHiddenText:getVisuallyHiddenText(zashiki)}]}};}function transformObject({elements:{fields=[]}={}}={},resource={},array=[],group=[]){log('transformObject');return fields.reduce((accumulator,field,i,a)=>{if((0,_common.hasElementsTitle)(field)){group=getGroup(i,a);if(group.length){return accumulator.concat(transformObjectGroup([field,...group],resource));}}return group.includes(field)?accumulator:accumulator.concat(transform(field,resource,array,group));},array);}function transformArray({elements:{fields=[]}={}}={},resource={},array=[],group=[]){log('transformArray');return fields.reduce((accumulator,field,i,a)=>{if((0,_common.hasElementsTitle)(field)){group=getGroup(i,a);if(group.length){return accumulator.concat(transformArrayGroup([field,...group],resource));}}return group.includes(field)?accumulator:accumulator.concat(transform(field,resource,array,group));},array);}function transformBoolean(zashiki,resource){log('transformBoolean');return{key:transformSummaryKey(zashiki),value:transformSummaryValue(zashiki),actions:{items:[{href:(0,_getResourceUrl.default)(resource),text:'Change',visuallyHiddenText:getVisuallyHiddenText(zashiki)}]}};}function transformNull(zashiki,resource){log('transformNull');return{key:transformSummaryKey(zashiki),value:transformSummaryValue(zashiki),actions:{items:[{href:(0,_getResourceUrl.default)(resource),text:'Change',visuallyHiddenText:getVisuallyHiddenText(zashiki)}]}};}function transformObjectGroupSummaryValue(group=[]){log('transformObjectGroupSummaryValue');return{html:group.reduce((accumulator,field)=>{const value=transformSummaryValue(field);if((0,_common.hasText)(value)){return accumulator.concat((0,_common.getText)(value));}else{if((0,_common.hasHtml)(value)){return accumulator.concat((0,_common.getHtml)(value));}}return accumulator;},[]).join('<br>')};}function transformArrayGroupSummaryValue(group=[]){log('transformArrayGroupSummaryValue');return{html:group.reduce((accumulator,field)=>{const value=transformSummaryValue(field);if((0,_common.hasText)(value)){return accumulator.concat(`<p class="govuk-body">${(0,_common.getText)(value)}</p>`);}else{if((0,_common.hasHtml)(value)){return accumulator.concat(`<p class="govuk-body">${(0,_common.getHtml)(value)}</p>`);}}return accumulator;},[]).join('\n')};}function transformObjectGroup(group=[],resource={}){log('transformObjectGroup');const[field]=group;return{key:transformSummaryKey(field),value:transformObjectGroupSummaryValue(group),actions:{items:[{href:(0,_getResourceUrl.default)(resource),text:'Change',visuallyHiddenText:getVisuallyHiddenText(field)}]}};}function transformArrayGroup(group=[],resource={}){log('transformArrayGroup');const[field]=group;return{key:transformSummaryKey(field),value:transformArrayGroupSummaryValue(group),actions:{items:[{href:(0,_getResourceUrl.default)(resource),text:'Change',visuallyHiddenText:getVisuallyHiddenText(field)}]}};}function transform(zashiki={},resource={},array=[],group=[]){log('transform');const{meta:{type}={}}=zashiki;switch(type){case'string':return transformString(zashiki,resource);case'number':return transformNumber(zashiki,resource);case'object':return transformObject(zashiki,resource,array,group);case'array':return transformArray(zashiki,resource,array,group);case'boolean':return transformBoolean(zashiki,resource);case'null':return transformNull(zashiki,resource);default:throw new Error('Zashiki incompatible with transformer');}}var _default=(definition,response,resource)=>transform((0,_toZashiki.default)(definition,response!==undefined?(0,_fromDocumentToHash.default)(response,definition):{}),resource);exports.default=_default;