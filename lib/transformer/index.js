"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.transformElementsToCheckboxesEnum=transformElementsToCheckboxesEnum;exports.transformElementsToCheckboxesAnyOf=transformElementsToCheckboxesAnyOf;exports.transformElementsToCheckboxesOneOf=transformElementsToCheckboxesOneOf;exports.transformElementsToCheckboxesField=transformElementsToCheckboxesField;exports.transformElementsToRadiosEnum=transformElementsToRadiosEnum;exports.transformElementsToRadiosAnyOf=transformElementsToRadiosAnyOf;exports.transformElementsToRadiosOneOf=transformElementsToRadiosOneOf;exports.transformElementsToSelectEnum=transformElementsToSelectEnum;exports.transformElementsToSelectAnyOf=transformElementsToSelectAnyOf;exports.transformElementsToSelectOneOf=transformElementsToSelectOneOf;exports.transformFields=transformFields;exports.transformField=transformField;exports.transformElementsToRadiosForEnum=transformElementsToRadiosForEnum;exports.transformElementsToRadiosForAnyOf=transformElementsToRadiosForAnyOf;exports.transformElementsToRadiosForOneOf=transformElementsToRadiosForOneOf;exports.transformElementsToSelectForEnum=transformElementsToSelectForEnum;exports.transformElementsToSelectForAnyOf=transformElementsToSelectForAnyOf;exports.transformElementsToSelectForOneOf=transformElementsToSelectForOneOf;exports.transformElementsToInputForEnum=transformElementsToInputForEnum;exports.transformElementsToInputForAnyOf=transformElementsToInputForAnyOf;exports.transformElementsToInputForOneOf=transformElementsToInputForOneOf;exports.transformElementsToInputForField=transformElementsToInputForField;exports.transformFieldToCheckboxes=transformFieldToCheckboxes;exports.transformFieldToDateInput=transformFieldToDateInput;exports.transformFieldToFileUpload=transformFieldToFileUpload;exports.transformFieldToRadios=transformFieldToRadios;exports.transformFieldToSelect=transformFieldToSelect;exports.transformFieldToInput=transformFieldToInput;exports.transformFieldsToDateInput=transformFieldsToDateInput;exports.transformFieldsToFileUpload=transformFieldsToFileUpload;exports.transformFieldsToInput=transformFieldsToInput;exports.transformFieldsToComponent=transformFieldsToComponent;exports.transformFieldToComponent=transformFieldToComponent;exports.transformOne=transformOne;exports.transformAll=transformAll;exports.transformEmbark=transformEmbark;exports.transformAlpha=transformAlpha;exports.transformOmega=transformOmega;exports.transformDebark=transformDebark;exports.default=exports.transformFieldsToCheckboxes=exports.transformElementsToCheckboxesForField=exports.transformElementsToCheckboxesForOneOf=exports.transformElementsToCheckboxesForAnyOf=exports.transformElementsToCheckboxesForEnum=exports.transformElementsToGroup=exports.transformElementsToInputField=exports.transformElementsToInputOneOf=exports.transformElementsToInputAnyOf=exports.transformElementsToInputEnum=exports.transformTitleToFieldsetLegend=exports.transformTitleToLegend=exports.transformTitleToLabel=exports.transformTitleToText=exports.transformDescriptionToHint=exports.getName=exports.getValue=exports.hasValue=exports.getRequired=exports.hasRequired=exports.getComponent=exports.hasComponent=exports.getType=exports.hasType=exports.getAnyOf=exports.hasAnyOf=exports.getOneOf=exports.hasOneOf=exports.getEnum=exports.hasEnum=void 0;var _debug=_interopRequireDefault(require("debug"));var _toZashiki=_interopRequireDefault(require("shinkansen-transmission/lib/transmission/to-zashiki"));var _fromDocumentToHash=_interopRequireDefault(require("shinkansen-transmission/lib/transmission/from-document-to-hash"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}const log=(0,_debug.default)('zashiki:transformer');const hasEnum=(field={})=>Reflect.has(field,'enum');exports.hasEnum=hasEnum;const getEnum=(field={})=>Reflect.get(field,'enum');exports.getEnum=getEnum;const hasOneOf=(field={})=>Reflect.has(field,'oneOf');exports.hasOneOf=hasOneOf;const getOneOf=(field={})=>Reflect.get(field,'oneOf');exports.getOneOf=getOneOf;const hasAnyOf=(field={})=>Reflect.has(field,'anyOf');exports.hasAnyOf=hasAnyOf;const getAnyOf=(field={})=>Reflect.get(field,'anyOf');exports.getAnyOf=getAnyOf;const hasType=(meta={})=>Reflect.has(meta,'type');exports.hasType=hasType;const getType=(meta={})=>Reflect.get(meta,'type');exports.getType=getType;const hasComponent=(meta={})=>Reflect.has(meta,'component');exports.hasComponent=hasComponent;const getComponent=(meta={})=>Reflect.get(meta,'component');exports.getComponent=getComponent;const hasRequired=field=>Reflect.has(field,'required');exports.hasRequired=hasRequired;const getRequired=field=>Reflect.get(field,'required');exports.getRequired=getRequired;const hasValue=field=>Reflect.has(field,'value');exports.hasValue=hasValue;const getValue=field=>Reflect.get(field,'value');exports.getValue=getValue;const getName=({name}={})=>name?{name}:{};exports.getName=getName;const transformDescriptionToHint=(field={},text)=>({...field,...(text?{hint:{text}}:{})});exports.transformDescriptionToHint=transformDescriptionToHint;const transformTitleToText=(field={},text)=>({...field,...(text?{text}:{})});exports.transformTitleToText=transformTitleToText;const transformTitleToLabel=(field={},text)=>({...field,...(text?{label:{text}}:{})});exports.transformTitleToLabel=transformTitleToLabel;const transformTitleToLegend=(field={},text)=>({...field,...(text?{legend:{text}}:{})});exports.transformTitleToLegend=transformTitleToLegend;const transformTitleToFieldsetLegend=(field={},text)=>({...field,...(text?{fieldset:{legend:{text}}}:{})});exports.transformTitleToFieldsetLegend=transformTitleToFieldsetLegend;function transformElementsToCheckboxesEnum({selectedItems=[]},{enum:{items=[],id,name=id,...field}},{uri,parentUri=uri}){log('transformElementsToCheckboxesEnum');return{id:parentUri,items:items.map((value,index)=>({text:String(value),value:String(index),id,name,checked:selectedItems.includes(index)})),...(hasRequired(field)?{required:getRequired(field)}:{})};}function transformElementsToCheckboxesAnyOf({selectedItems=[]},{anyOf:{items=[],id,...field}},{uri,parentUri=uri}){log('transformElementsToCheckboxesAnyOf');return{id:parentUri,items:items.map(({elements:{title,description,field:{id,name=id}={}}},index)=>transformDescriptionToHint(transformTitleToText({value:String(index),id,name,checked:selectedItems.includes(index)},title),description)),...(hasRequired(field)?{required:getRequired(field)}:{})};}function transformElementsToCheckboxesOneOf({selectedItems=[]},{oneOf:{items=[],id,...field}},{uri,parentUri=uri}){log('transformElementsToCheckboxesOneOf');return{id:parentUri,items:items.map(({elements:{title,description,field:{id,name=id}={}}},index)=>transformDescriptionToHint(transformTitleToText({value:String(index),id,name,checked:selectedItems.includes(index)},title),description)),...(hasRequired(field)?{required:getRequired(field)}:{})};}function transformElementsToCheckboxesField({selectedItems=[]},{field:{value,id,name=id,...field}},{uri,parentUri=uri}){log('transformElementsToCheckboxesField');return{id:parentUri,items:[{text:value,value,id,name,checked:selectedItems.includes(value)}],...(hasRequired(field)?{required:getRequired(field)}:{})};}function transformElementsToRadiosEnum({selectedItems=[]},{enum:{id,name=id,items=[],...field}}){log('transformElementsToRadiosEnum');return{id,name,items:items.map((value,index)=>{return{text:String(value),value:String(index),checked:selectedItems.includes(index)};}),...(hasRequired(field)?{required:getRequired(field)}:{})};}function transformElementsToRadiosAnyOf({selectedItems=[]},{anyOf:{id,name=id,items=[],...field}}){log('transformElementsToRadiosAnyOf');return{id,name,items:items.map(({elements:{title,description,field:{id,value}={}}},index)=>{return transformDescriptionToHint({...(title?{text:title}:{text:String(value)}),value:String(index),id,checked:selectedItems.includes(index)},description);}),...(hasRequired(field)?{required:getRequired(field)}:{})};}function transformElementsToRadiosOneOf({selectedItems=[]},{oneOf:{id,name=id,items=[],...field}}){log('transformElementsToRadiosOneOf');return{id,name,items:items.map(({elements:{title,description,field:{id,value}={}}},index)=>{return transformDescriptionToHint({...(title?{text:title}:{text:String(value)}),value:String(index),id,checked:selectedItems.includes(index)},description);}),...(hasRequired(field)?{required:getRequired(field)}:{})};}function transformElementsToSelectEnum({selectedItems=[]},{enum:{id,name=id,items=[],...field}}){log('transformElementsToSelectEnum');return{id,name,items:items.map((value,index)=>{return{text:String(value),value:String(index),selected:selectedItems.includes(index)};}),...(hasRequired(field)?{required:getRequired(field)}:{})};}function transformElementsToSelectAnyOf({selectedItems=[]},{anyOf:{id,name=id,items=[],...field}}){log('transformElementsToSelectAnyOf');return{id,name,items:items.map(({elements:{title,field:{value}}},index)=>{return{...(title?{text:title}:{text:String(value)}),value:String(index),selected:selectedItems.includes(index)};}),...(hasRequired(field)?{required:getRequired(field)}:{})};}function transformElementsToSelectOneOf({selectedItems=[]},{oneOf:{id,name=id,items=[],...field}}){log('transformElementsToSelectOneOf');return{id,name,items:items.map(({elements:{title,field:{value}}},index)=>{return{...(title?{text:title}:{text:String(value)}),value:String(index),selected:selectedItems.includes(index)};}),...(hasRequired(field)?{required:getRequired(field)}:{})};}const transformElementsToInputEnum=({items=[],selectedItems=[]},{enum:{id,name=id,...field}})=>{log('transformElementsToInputEnum');return{items:items.map((value,index)=>({text:String(value),value:String(index),selected:selectedItems.includes(index)})),...(id?{id}:{}),...(name?{name}:{}),...(hasRequired(field)?{required:getRequired(field)}:{})};};exports.transformElementsToInputEnum=transformElementsToInputEnum;const transformElementsToInputAnyOf=({items=[],selectedItems=[]},{anyOf:{id,name=id,...field}})=>{log('transformElementsToInputAnyOf');return{items:items.map(({elements:{title,description,field:{id,name=id}={}}},index)=>transformDescriptionToHint(transformTitleToText({value:String(index),id,name,checked:selectedItems.includes(index)},title),description)),...(id?{id}:{}),...(name?{name}:{}),...(hasRequired(field)?{required:getRequired(field)}:{})};};exports.transformElementsToInputAnyOf=transformElementsToInputAnyOf;const transformElementsToInputOneOf=({items=[],selectedItems=[]},{oneOf:{id,name=id,...field}})=>{log('transformElementsToInputOneOf');return{items:items.map(({elements:{title,description,field:{id,name=id}={}}},index)=>transformDescriptionToHint(transformTitleToText({value:String(index),id,name,checked:selectedItems.includes(index)},title),description)),...(id?{id}:{}),...(name?{name}:{}),...(hasRequired(field)?{required:getRequired(field)}:{})};};exports.transformElementsToInputOneOf=transformElementsToInputOneOf;const transformElementsToInputField=(meta,{field:{id,name=id,...field}})=>{log('transformElementsToInputField');return{...(id?{id}:{}),...(name?{name}:{}),...(hasValue(field)?{value:getValue(field)}:{}),...(hasRequired(field)?{required:getRequired(field)}:{})};};exports.transformElementsToInputField=transformElementsToInputField;const transformElementsToGroup=(meta,{id,name=id,...elements}={})=>{return{...(id?{id}:{}),...(name?{name}:{}),...(hasRequired(elements)?{required:getRequired(elements)}:{}),...(hasValue(elements)?{value:getValue(elements)}:{})};};exports.transformElementsToGroup=transformElementsToGroup;function transformFields(meta,elements){log('transformFields');const{title,fields=[]}=elements;return{group:transformTitleToLegend(transformElementsToGroup(meta,elements),title),fields:fields.map(transform)};}function transformField(meta,elements){log('transformField');if(hasEnum(elements)){log('transformField (`enum`)');return{enum:transformElementsToInputForEnum(meta,elements)};}else{if(hasAnyOf(elements)){log('transformField (`anyOf`)');return{anyOf:transformElementsToInputForAnyOf(meta,elements)};}else{if(hasOneOf(elements)){log('transformField (`oneOf`)');return{oneOf:transformElementsToInputForOneOf(meta,elements)};}else{log('transformField (`field`)');return{field:transformElementsToInputForField(meta,elements)};}}}}const transformElementsToCheckboxesForEnum=(meta,elements,parentMeta,{title,description})=>transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToCheckboxesEnum(meta,elements,parentMeta),title),description);exports.transformElementsToCheckboxesForEnum=transformElementsToCheckboxesForEnum;const transformElementsToCheckboxesForAnyOf=(meta,elements,parentMeta,{title,description})=>transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToCheckboxesAnyOf(meta,elements,parentMeta),title),description);exports.transformElementsToCheckboxesForAnyOf=transformElementsToCheckboxesForAnyOf;const transformElementsToCheckboxesForOneOf=(meta,elements,parentMeta,{title,description})=>transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToCheckboxesOneOf(meta,elements,parentMeta),title),description);exports.transformElementsToCheckboxesForOneOf=transformElementsToCheckboxesForOneOf;const transformElementsToCheckboxesForField=(meta,elements,parentMeta,{title,description})=>transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToCheckboxesField(meta,elements,parentMeta),title),description);exports.transformElementsToCheckboxesForField=transformElementsToCheckboxesForField;function transformElementsToRadiosForEnum(meta,elements){const{title,description}=elements;return transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToRadiosEnum(meta,elements),title),description);}function transformElementsToRadiosForAnyOf(meta,elements){const{title,description}=elements;return transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToRadiosAnyOf(meta,elements),title),description);}function transformElementsToRadiosForOneOf(meta,elements){const{title,description}=elements;return transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToRadiosOneOf(meta,elements),title),description);}function transformElementsToSelectForEnum(meta,elements){const{title,description}=elements;return transformDescriptionToHint(transformTitleToLabel(transformElementsToSelectEnum(meta,elements),title),description);}function transformElementsToSelectForAnyOf(meta,elements){const{title,description}=elements;return transformDescriptionToHint(transformTitleToLabel(transformElementsToSelectAnyOf(meta,elements),title),description);}function transformElementsToSelectForOneOf(meta,elements){const{title,description}=elements;return transformDescriptionToHint(transformTitleToLabel(transformElementsToSelectOneOf(meta,elements),title),description);}function transformElementsToInputForEnum(meta,elements){const{title,description}=elements;return transformDescriptionToHint(transformTitleToLabel(transformElementsToInputEnum(meta,elements),title),description);}function transformElementsToInputForAnyOf(meta,elements){const{title,description}=elements;return transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToInputAnyOf(meta,elements),title),description);}function transformElementsToInputForOneOf(meta,elements){const{title,description}=elements;return transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToInputOneOf(meta,elements),title),description);}function transformElementsToInputForField(meta,elements){const{title,description}=elements;return transformDescriptionToHint(transformTitleToLabel(transformElementsToInputField(meta,elements),title),description);}function transformFieldToCheckboxes(meta,elements,parentMeta,parentElements){log('transformFieldToCheckboxes');if(hasEnum(elements)){log('transformFieldToCheckboxes (`enum`)');return{enum:transformElementsToCheckboxesForEnum(meta,elements,parentMeta,parentElements)};}else{if(hasAnyOf(elements)){log('transformFieldToCheckboxes (`anyOf`)');return{anyOf:transformElementsToCheckboxesForAnyOf(meta,elements,parentMeta,parentElements)};}else{if(hasOneOf(elements)){log('transformFieldToCheckboxes (`oneOf`)');return{oneOf:transformElementsToCheckboxesForOneOf(meta,elements,parentMeta,parentElements)};}else{log('transformFieldToCheckboxes (`field`)');return{field:transformElementsToCheckboxesForField(meta,elements,parentMeta,parentElements)};}}}}function transformFieldToDateInput(meta,elements){}function transformFieldToFileUpload(meta,elements){}function transformFieldToRadios(meta,elements){log('transformFieldToRadios');if(hasEnum(elements)){log('transformFieldToRadios (`enum`)');return{enum:transformElementsToRadiosForEnum(meta,elements)};}else{if(hasAnyOf(elements)){log('transformFieldToRadios (`anyOf`)');return{anyOf:transformElementsToRadiosForAnyOf(meta,elements)};}else{if(hasOneOf(elements)){log('transformFieldToRadios (`oneOf`)');return{oneOf:transformElementsToRadiosForOneOf(meta,elements)};}else{log('transformFieldToRadios (`field`)');throw new Error('Schema incompatible with component `radios`');}}}}function transformFieldToSelect(meta,elements){log('transformFieldToSelect');if(hasEnum(elements)){log('transformFieldToSelect (`enum`)');return{enum:transformElementsToSelectForEnum(meta,elements)};}else{if(hasAnyOf(elements)){log('transformFieldToSelect (`anyOf`)');return{anyOf:transformElementsToSelectForAnyOf(meta,elements)};}else{if(hasOneOf(elements)){log('transformFieldToSelect (`oneOf`)');return{oneOf:transformElementsToSelectForOneOf(meta,elements)};}else{log('transformFieldToSelect (`field`)');throw new Error('Schema incompatible with component `select`');}}}}function transformFieldToInput(meta,elements){log('transformFieldToInput');if(hasEnum(elements)){log('transformFieldToInput (`enum`)');return{enum:transformElementsToInputForEnum(meta,elements)};}else{if(hasAnyOf(elements)){log('transformFieldToInput (`anyOf`)');return{anyOf:transformElementsToInputForAnyOf(meta,elements)};}else{if(hasOneOf(elements)){log('transformFieldToInput (`oneOf`)');return{oneOf:transformElementsToInputForOneOf(meta,elements)};}else{log('transformFieldToInput (`field`)');return{field:transformElementsToInputForField(meta,elements)};}}}}const transformFieldsToCheckboxes=(parentMeta,{fields:[{meta,elements}={}]=[],title,description}={})=>{return transformFieldToCheckboxes(meta,elements,parentMeta,{title,description});};exports.transformFieldsToCheckboxes=transformFieldsToCheckboxes;function transformFieldsToDateInput(meta,elements){const{title,fields=[]}=elements;return{group:transformTitleToLegend(transformElementsToGroup(meta,elements),title),fields:fields.map(transform)};}function transformFieldsToFileUpload(meta,elements){const{title,fields=[]}=elements;return{group:transformTitleToLegend(transformElementsToGroup(meta,elements),title),fields:fields.map(transform)};}function transformFieldsToInput(meta,elements){const{title,fields=[]}=elements;return{group:transformTitleToLegend(transformElementsToGroup(meta,elements),title),fields:fields.map(transform)};}function transformFieldsToComponent(meta,elements){log('transformFieldsToComponent');const{component}=meta;switch(component){case'checkboxes':return transformFieldsToCheckboxes(meta,elements);default:return transformFieldsToInput(meta,elements);}}function transformFieldToComponent(meta,elements){log('transformFieldToComponent');const{component}=meta;switch(component){case'date-input':return transformFieldToDateInput(meta,elements);case'file-upload':return transformFieldToFileUpload(meta,elements);case'radios':return transformFieldToRadios(meta,elements);case'select':return transformFieldToSelect(meta,elements);default:return transformFieldToInput(meta,elements);}}function transformOne({meta={},elements={}}={}){log('transformOne');const type=getType(meta);if(hasComponent(meta)){const component=getComponent(meta);return{type,component,...transformFieldToComponent(meta,elements)};}else{return{type,...transformField(meta,elements)};}}function transformAll({meta={},elements={}}={}){log('transformAll');const type=getType(meta);if(hasComponent(meta)){const component=getComponent(meta);return{type,component,...transformFieldsToComponent(meta,elements)};}else{return{type,...transformFields(meta,elements)};}}const transform=(zashiki={})=>{const{meta:{type}={}}=zashiki;return type==='object'||type==='array'?transformAll(zashiki):transformOne(zashiki);};function transformEmbark(definition,response,components){return transform((0,_toZashiki.default)(definition,response!==undefined?(0,_fromDocumentToHash.default)(response,definition):{},components));}function transformAlpha(description,definition,response,{meta:{classes='govuk-fieldset__legend--m',isPageHeading=false,...meta}={},...components}={}){const zashiki=(0,_toZashiki.default)(definition,response!==undefined?(0,_fromDocumentToHash.default)(response,definition):{},components);const{meta:{type}={}}=zashiki;if(type==='object'||type==='array'){return{zashiki:{group:{legend:{text:description,classes,isPageHeading}},fields:transformAll(zashiki)}};}else{return{zashiki:{group:{legend:{text:description,classes,isPageHeading}},fields:transformOne(zashiki)}};}}function transformOmega(description,definition,response,{meta:{classes='govuk-fieldset__legend--l',isPageHeading=true,...meta}={},...components}={}){const zashiki=(0,_toZashiki.default)(definition,response!==undefined?(0,_fromDocumentToHash.default)(response,definition):{},{...components,meta:{...meta,isPageHeading:true}});const{meta:{type}={}}=zashiki;if(type==='object'||type==='array'){return{zashiki:{group:{legend:{text:description,classes,isPageHeading}},fields:transformAll(zashiki)}};}else{return{zashiki:{group:{legend:{text:description,classes,isPageHeading}},fields:transformOne(zashiki)}};}}function transformDebark(definition,response,components){return transform((0,_toZashiki.default)(definition,response!==undefined?(0,_fromDocumentToHash.default)(response,definition):{},components));}var _default=(definition,response,components={})=>transform((0,_toZashiki.default)(definition,response!==undefined?(0,_fromDocumentToHash.default)(response,definition):{},components));exports.default=_default;