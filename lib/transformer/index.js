"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.transformElementsToCheckboxesEnum=transformElementsToCheckboxesEnum;exports.transformElementsToCheckboxesAnyOf=transformElementsToCheckboxesAnyOf;exports.transformElementsToCheckboxesOneOf=transformElementsToCheckboxesOneOf;exports.transformElementsToCheckboxesField=transformElementsToCheckboxesField;exports.transformElementsToRadiosEnum=transformElementsToRadiosEnum;exports.transformElementsToRadiosAnyOf=transformElementsToRadiosAnyOf;exports.transformElementsToRadiosOneOf=transformElementsToRadiosOneOf;exports.transformElementsToSelectEnum=transformElementsToSelectEnum;exports.transformElementsToSelectAnyOf=transformElementsToSelectAnyOf;exports.transformElementsToSelectOneOf=transformElementsToSelectOneOf;exports.transformElementsToInputEnum=transformElementsToInputEnum;exports.transformElementsToInputAnyOf=transformElementsToInputAnyOf;exports.transformElementsToInputOneOf=transformElementsToInputOneOf;exports.transformElementsToInputField=transformElementsToInputField;exports.transformElementsToGroup=transformElementsToGroup;exports.transformFields=transformFields;exports.transformField=transformField;exports.transformElementsToRadiosForEnum=transformElementsToRadiosForEnum;exports.transformElementsToRadiosForAnyOf=transformElementsToRadiosForAnyOf;exports.transformElementsToRadiosForOneOf=transformElementsToRadiosForOneOf;exports.transformElementsToSelectForEnum=transformElementsToSelectForEnum;exports.transformElementsToSelectForAnyOf=transformElementsToSelectForAnyOf;exports.transformElementsToSelectForOneOf=transformElementsToSelectForOneOf;exports.transformElementsToInputForEnum=transformElementsToInputForEnum;exports.transformElementsToInputForAnyOf=transformElementsToInputForAnyOf;exports.transformElementsToInputForOneOf=transformElementsToInputForOneOf;exports.transformElementsToInputForField=transformElementsToInputForField;exports.transformFieldToCheckboxes=transformFieldToCheckboxes;exports.transformFieldToDateInput=transformFieldToDateInput;exports.transformFieldToFileUpload=transformFieldToFileUpload;exports.transformFieldToRadios=transformFieldToRadios;exports.transformFieldToSelect=transformFieldToSelect;exports.transformFieldToInput=transformFieldToInput;exports.transformFieldsToDateInput=transformFieldsToDateInput;exports.transformFieldsToFileUpload=transformFieldsToFileUpload;exports.transformFieldsToInput=transformFieldsToInput;exports.transformFieldsToComponent=transformFieldsToComponent;exports.transformFieldToComponent=transformFieldToComponent;exports.transformOne=transformOne;exports.transformAll=transformAll;exports.transformEmbark=transformEmbark;exports.transformAlpha=transformAlpha;exports.transformOmega=transformOmega;exports.transformDebark=transformDebark;exports.default=exports.transformFieldsToCheckboxes=exports.transformElementsToCheckboxesForField=exports.transformElementsToCheckboxesForOneOf=exports.transformElementsToCheckboxesForAnyOf=exports.transformElementsToCheckboxesForEnum=exports.transformTitleToFieldsetLegend=exports.transformTitleToLegend=exports.transformTitleToLabel=exports.transformTitleToText=exports.transformDescriptionToHint=exports.getName=void 0;var _debug=_interopRequireDefault(require("debug"));var _toZashiki=_interopRequireDefault(require("shinkansen-transmission/lib/transmission/to-zashiki"));var _fromDocumentToHash=_interopRequireDefault(require("shinkansen-transmission/lib/transmission/from-document-to-hash"));var _common=require("./common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}const log=(0,_debug.default)('zashiki:transformer:transform');const getName=({name}={})=>name?{name}:{};exports.getName=getName;const transformDescriptionToHint=(field={},text)=>({...field,...(text?{hint:{text}}:{})});exports.transformDescriptionToHint=transformDescriptionToHint;const transformTitleToText=(field={},text)=>({...field,...(text?{text}:{})});exports.transformTitleToText=transformTitleToText;const transformTitleToLabel=(field={},text)=>({...field,...(text?{label:{text}}:{})});exports.transformTitleToLabel=transformTitleToLabel;const transformTitleToLegend=(field={},text)=>({...field,...(text?{legend:{text}}:{})});exports.transformTitleToLegend=transformTitleToLegend;const transformTitleToFieldsetLegend=(field={},text)=>({...field,...(text?{fieldset:{legend:{text}}}:{})});exports.transformTitleToFieldsetLegend=transformTitleToFieldsetLegend;function transformElementsToCheckboxesEnum({selectedItems=[]},{enum:{items=[],id,name=id,...field}},{uri,parentUri=uri}){log('transformElementsToCheckboxesEnum');return{id:parentUri,items:items.map((value,index)=>({text:String(value),value:String(index),id,name,checked:selectedItems.includes(index)})),...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToCheckboxesAnyOf({selectedItems=[]},{anyOf:{items=[],id,...field}},{uri,parentUri=uri}){log('transformElementsToCheckboxesAnyOf');return{id:parentUri,items:items.map(({elements:{title,description,field:{id,name=id}={}}},index)=>transformDescriptionToHint(transformTitleToText({value:String(index),id,name,checked:selectedItems.includes(index)},title),description)),...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToCheckboxesOneOf({selectedItems=[]},{oneOf:{items=[],id,...field}},{uri,parentUri=uri}){log('transformElementsToCheckboxesOneOf');return{id:parentUri,items:items.map(({elements:{title,description,field:{id,name=id}={}}},index)=>transformDescriptionToHint(transformTitleToText({value:String(index),id,name,checked:selectedItems.includes(index)},title),description)),...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToCheckboxesField({selectedItems=[]},{field:{value,id,name=id,...field}},{uri,parentUri=uri}){log('transformElementsToCheckboxesField');return{id:parentUri,items:[{text:value,value,id,name,checked:selectedItems.includes(value)}],...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToRadiosEnum({selectedItems=[]},{enum:{id,name=id,items=[],...field}}){log('transformElementsToRadiosEnum');return{id,name,items:items.map((value,index)=>{return{text:String(value),value:String(index),checked:selectedItems.includes(index)};}),...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToRadiosAnyOf({selectedItems=[]},{anyOf:{id,name=id,items=[],...field}}){log('transformElementsToRadiosAnyOf');return{id,name,items:items.map(({elements:{title,description,field:{id,value}={}}},index)=>{return transformDescriptionToHint({...(title?{text:title}:{text:String(value)}),value:String(index),id,checked:selectedItems.includes(index)},description);}),...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToRadiosOneOf({selectedItems=[]},{oneOf:{id,name=id,items=[],...field}}){log('transformElementsToRadiosOneOf');return{id,name,items:items.map(({elements:{title,description,field:{id,value}={}}},index)=>{return transformDescriptionToHint({...(title?{text:title}:{text:String(value)}),value:String(index),id,checked:selectedItems.includes(index)},description);}),...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToSelectEnum({selectedItems=[]},{enum:{id,name=id,items=[],...field}}){log('transformElementsToSelectEnum');return{id,name,items:items.map((value,index)=>{return{text:String(value),value:String(index),selected:selectedItems.includes(index)};}),...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToSelectAnyOf({selectedItems=[]},{anyOf:{id,name=id,items=[],...field}}){log('transformElementsToSelectAnyOf');return{id,name,items:items.map(({elements:{title,field:{value}}},index)=>{return{...(title?{text:title}:{text:String(value)}),value:String(index),selected:selectedItems.includes(index)};}),...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToSelectOneOf({selectedItems=[]},{oneOf:{id,name=id,items=[],...field}}){log('transformElementsToSelectOneOf');return{id,name,items:items.map(({elements:{title,field:{value}}},index)=>{return{...(title?{text:title}:{text:String(value)}),value:String(index),selected:selectedItems.includes(index)};}),...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToInputEnum({items=[],selectedItems=[]},{enum:{id,name=id,...field}}){log('transformElementsToInputEnum');return{items:items.map((value,index)=>({text:String(value),value:String(index),selected:selectedItems.includes(index)})),...(id?{id}:{}),...(name?{name}:{}),...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToInputAnyOf({items=[],selectedItems=[]},{anyOf:{id,name=id,...field}}){log('transformElementsToInputAnyOf');return{items:items.map(({elements:{title,description,field:{id,name=id}={}}},index)=>transformDescriptionToHint(transformTitleToText({value:String(index),id,name,checked:selectedItems.includes(index)},title),description)),...(id?{id}:{}),...(name?{name}:{}),...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToInputOneOf({items=[],selectedItems=[]},{oneOf:{id,name=id,...field}}){log('transformElementsToInputOneOf');return{items:items.map(({elements:{title,description,field:{id,name=id}={}}},index)=>transformDescriptionToHint(transformTitleToText({value:String(index),id,name,checked:selectedItems.includes(index)},title),description)),...(id?{id}:{}),...(name?{name}:{}),...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToInputField(meta,{field:{id,name=id,...field}}){log('transformElementsToInputField');return{...(id?{id}:{}),...(name?{name}:{}),...((0,_common.hasValue)(field)?{value:(0,_common.getValue)(field)}:{}),...((0,_common.hasRequired)(field)?{required:(0,_common.getRequired)(field)}:{})};}function transformElementsToGroup(meta,{id,name=id,...elements}={}){log('transformElementsToGroup');return{...(id?{id}:{}),...(name?{name}:{}),...((0,_common.hasRequired)(elements)?{required:(0,_common.getRequired)(elements)}:{}),...((0,_common.hasValue)(elements)?{value:(0,_common.getValue)(elements)}:{})};}function transformFields(meta,elements){log('transformFields');const{title,fields=[]}=elements;return{group:transformTitleToLegend(transformElementsToGroup(meta,elements),title),fields:fields.map(transform)};}function transformField(meta,elements){log('transformField');if((0,_common.hasEnum)(elements)){log('transformField (`enum`)');return{enum:transformElementsToInputForEnum(meta,elements)};}else{if((0,_common.hasAnyOf)(elements)){log('transformField (`anyOf`)');return{anyOf:transformElementsToInputForAnyOf(meta,elements)};}else{if((0,_common.hasOneOf)(elements)){log('transformField (`oneOf`)');return{oneOf:transformElementsToInputForOneOf(meta,elements)};}else{log('transformField (`field`)');return{field:transformElementsToInputForField(meta,elements)};}}}}const transformElementsToCheckboxesForEnum=(meta,elements,parentMeta,{title,description})=>transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToCheckboxesEnum(meta,elements,parentMeta),title),description);exports.transformElementsToCheckboxesForEnum=transformElementsToCheckboxesForEnum;const transformElementsToCheckboxesForAnyOf=(meta,elements,parentMeta,{title,description})=>transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToCheckboxesAnyOf(meta,elements,parentMeta),title),description);exports.transformElementsToCheckboxesForAnyOf=transformElementsToCheckboxesForAnyOf;const transformElementsToCheckboxesForOneOf=(meta,elements,parentMeta,{title,description})=>transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToCheckboxesOneOf(meta,elements,parentMeta),title),description);exports.transformElementsToCheckboxesForOneOf=transformElementsToCheckboxesForOneOf;const transformElementsToCheckboxesForField=(meta,elements,parentMeta,{title,description})=>transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToCheckboxesField(meta,elements,parentMeta),title),description);exports.transformElementsToCheckboxesForField=transformElementsToCheckboxesForField;function transformElementsToRadiosForEnum(meta,elements){log('transformElementsToRadiosForEnum');const{title,description}=elements;return transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToRadiosEnum(meta,elements),title),description);}function transformElementsToRadiosForAnyOf(meta,elements){log('transformElementsToRadiosForAnyOf');const{title,description}=elements;return transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToRadiosAnyOf(meta,elements),title),description);}function transformElementsToRadiosForOneOf(meta,elements){log('transformElementsToRadiosForOneOf');const{title,description}=elements;return transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToRadiosOneOf(meta,elements),title),description);}function transformElementsToSelectForEnum(meta,elements){log('transformElementsToSelectForEnum');const{title,description}=elements;return transformDescriptionToHint(transformTitleToLabel(transformElementsToSelectEnum(meta,elements),title),description);}function transformElementsToSelectForAnyOf(meta,elements){log('transformElementsToSelectForAnyOf');const{title,description}=elements;return transformDescriptionToHint(transformTitleToLabel(transformElementsToSelectAnyOf(meta,elements),title),description);}function transformElementsToSelectForOneOf(meta,elements){log('transformElementsToSelectForOneOf');const{title,description}=elements;return transformDescriptionToHint(transformTitleToLabel(transformElementsToSelectOneOf(meta,elements),title),description);}function transformElementsToInputForEnum(meta,elements){log('transformElementsToInputForEnum');const{title,description}=elements;return transformDescriptionToHint(transformTitleToLabel(transformElementsToInputEnum(meta,elements),title),description);}function transformElementsToInputForAnyOf(meta,elements){log('transformElementsToInputForAnyOf');const{title,description}=elements;return transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToInputAnyOf(meta,elements),title),description);}function transformElementsToInputForOneOf(meta,elements){log('transformElementsToInputForOneOf');const{title,description}=elements;return transformDescriptionToHint(transformTitleToFieldsetLegend(transformElementsToInputOneOf(meta,elements),title),description);}function transformElementsToInputForField(meta,elements){log('transformElementsToInputForField');const{title,description}=elements;return transformDescriptionToHint(transformTitleToLabel(transformElementsToInputField(meta,elements),title),description);}function transformFieldToCheckboxes(meta,elements,parentMeta,parentElements){log('transformFieldToCheckboxes');if((0,_common.hasEnum)(elements)){log('transformFieldToCheckboxes (`enum`)');return{enum:transformElementsToCheckboxesForEnum(meta,elements,parentMeta,parentElements)};}else{if((0,_common.hasAnyOf)(elements)){log('transformFieldToCheckboxes (`anyOf`)');return{anyOf:transformElementsToCheckboxesForAnyOf(meta,elements,parentMeta,parentElements)};}else{if((0,_common.hasOneOf)(elements)){log('transformFieldToCheckboxes (`oneOf`)');return{oneOf:transformElementsToCheckboxesForOneOf(meta,elements,parentMeta,parentElements)};}else{log('transformFieldToCheckboxes (`field`)');return{field:transformElementsToCheckboxesForField(meta,elements,parentMeta,parentElements)};}}}}function transformFieldToDateInput(meta,elements){}function transformFieldToFileUpload(meta,elements){}function transformFieldToRadios(meta,elements){log('transformFieldToRadios');if((0,_common.hasEnum)(elements)){log('transformFieldToRadios (`enum`)');return{enum:transformElementsToRadiosForEnum(meta,elements)};}else{if((0,_common.hasAnyOf)(elements)){log('transformFieldToRadios (`anyOf`)');return{anyOf:transformElementsToRadiosForAnyOf(meta,elements)};}else{if((0,_common.hasOneOf)(elements)){log('transformFieldToRadios (`oneOf`)');return{oneOf:transformElementsToRadiosForOneOf(meta,elements)};}else{log('transformFieldToRadios (`field`)');throw new Error('Schema incompatible with component `radios`');}}}}function transformFieldToSelect(meta,elements){log('transformFieldToSelect');if((0,_common.hasEnum)(elements)){log('transformFieldToSelect (`enum`)');return{enum:transformElementsToSelectForEnum(meta,elements)};}else{if((0,_common.hasAnyOf)(elements)){log('transformFieldToSelect (`anyOf`)');return{anyOf:transformElementsToSelectForAnyOf(meta,elements)};}else{if((0,_common.hasOneOf)(elements)){log('transformFieldToSelect (`oneOf`)');return{oneOf:transformElementsToSelectForOneOf(meta,elements)};}else{log('transformFieldToSelect (`field`)');throw new Error('Schema incompatible with component `select`');}}}}function transformFieldToInput(meta,elements){log('transformFieldToInput');if((0,_common.hasEnum)(elements)){log('transformFieldToInput (`enum`)');return{enum:transformElementsToInputForEnum(meta,elements)};}else{if((0,_common.hasAnyOf)(elements)){log('transformFieldToInput (`anyOf`)');return{anyOf:transformElementsToInputForAnyOf(meta,elements)};}else{if((0,_common.hasOneOf)(elements)){log('transformFieldToInput (`oneOf`)');return{oneOf:transformElementsToInputForOneOf(meta,elements)};}else{log('transformFieldToInput (`field`)');return{field:transformElementsToInputForField(meta,elements)};}}}}const transformFieldsToCheckboxes=(parentMeta,{fields:[{meta,elements}={}]=[],title,description}={})=>{log('transformFieldsToCheckboxes');return transformFieldToCheckboxes(meta,elements,parentMeta,{title,description});};exports.transformFieldsToCheckboxes=transformFieldsToCheckboxes;function transformFieldsToDateInput(meta,elements){log('transformFieldsToDateInput');const{title,fields=[]}=elements;return{group:transformTitleToLegend(transformElementsToGroup(meta,elements),title),fields:fields.map(transform)};}function transformFieldsToFileUpload(meta,elements){log('transformFieldsToFileUpload');const{title,fields=[]}=elements;return{group:transformTitleToLegend(transformElementsToGroup(meta,elements),title),fields:fields.map(transform)};}function transformFieldsToInput(meta,elements){log('transformFieldsToInput');const{title,fields=[]}=elements;return{group:transformTitleToLegend(transformElementsToGroup(meta,elements),title),fields:fields.map(transform)};}function transformFieldsToComponent(meta,elements){log('transformFieldsToComponent');const{component}=meta;switch(component){case'checkboxes':return transformFieldsToCheckboxes(meta,elements);default:return transformFieldsToInput(meta,elements);}}function transformFieldToComponent(meta,elements){log('transformFieldToComponent');const{component}=meta;switch(component){case'date-input':return transformFieldToDateInput(meta,elements);case'file-upload':return transformFieldToFileUpload(meta,elements);case'radios':return transformFieldToRadios(meta,elements);case'select':return transformFieldToSelect(meta,elements);default:return transformFieldToInput(meta,elements);}}function transformOne({meta={},elements={}}={}){log('transformOne');const{type}=meta;if((0,_common.hasComponent)(meta)){const component=(0,_common.getComponent)(meta);return{type,component,...transformFieldToComponent(meta,elements)};}else{return{type,...transformField(meta,elements)};}}function transformAll({meta={},elements={}}={}){log('transformAll');const{type}=meta;if((0,_common.hasComponent)(meta)){const component=(0,_common.getComponent)(meta);return{type,component,...transformFieldsToComponent(meta,elements)};}else{return{type,...transformFields(meta,elements)};}}const transform=(zashiki={})=>{log('transform');const{meta:{type}={}}=zashiki;return type==='object'||type==='array'?transformAll(zashiki):transformOne(zashiki);};function transformEmbark(definition,response,components){log('transformEmbark');return transform((0,_toZashiki.default)(definition,response!==undefined?(0,_fromDocumentToHash.default)(response,definition):{},components));}function transformAlpha(description,definition,response,{meta:{classes='govuk-fieldset__legend--m',isPageHeading=false,...meta}={},...components}={}){log('transformAlpha');const zashiki=(0,_toZashiki.default)(definition,response!==undefined?(0,_fromDocumentToHash.default)(response,definition):{},components);const{meta:{type}={}}=zashiki;if(type==='object'||type==='array'){return{zashiki:{group:{legend:{text:description,classes,isPageHeading}},fields:transformAll(zashiki)}};}return{zashiki:{group:{legend:{text:description,classes,isPageHeading}},fields:transformOne(zashiki)}};}function transformOmega(description,definition,response,{meta:{classes='govuk-fieldset__legend--l',isPageHeading=true,...meta}={},...components}={}){log('transformOmega');const zashiki=(0,_toZashiki.default)(definition,response!==undefined?(0,_fromDocumentToHash.default)(response,definition):{},{...components,meta:{...meta,isPageHeading:true}});const{meta:{type}={}}=zashiki;if(type==='object'||type==='array'){return{zashiki:{group:{legend:{text:description,classes,isPageHeading}},fields:transformAll(zashiki)}};}return{zashiki:{group:{legend:{text:description,classes,isPageHeading}},fields:transformOne(zashiki)}};}function transformDebark(definition,response,components){log('transformDebark');return transform((0,_toZashiki.default)(definition,response!==undefined?(0,_fromDocumentToHash.default)(response,definition):{},components));}var _default=(definition,response,components={})=>transform((0,_toZashiki.default)(definition,response!==undefined?(0,_fromDocumentToHash.default)(response,definition):{},components));exports.default=_default;